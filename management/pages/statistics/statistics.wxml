<!--pages/statistics/statistics.wxml-->
<navigation-bar title="åº“å­˜ç»Ÿè®¡" back="{{true}}" backAsHome="{{true}}" color="black" background="#FFF"></navigation-bar>
<scroll-view class="scrollarea" scroll-y scroll-into-view="{{scrollIntoView}}" type="list" refresher-enabled="{{true}}" bindrefresherrefresh="onPullDownRefresh">
  <view class="container">
    <!-- å‘Šè­¦æ¦‚è§ˆ -->
    <view class="warning-overview" wx:if="{{hasWarnings}}">
      <view class="warning-title">å‘Šè­¦æé†’</view>
      <view class="warning-items">
        <view class="warning-item low-stock" wx:if="{{lowStockCount > 0}}">
          <text class="warning-icon">âš ï¸</text>
          <text class="warning-text">{{lowStockCount}}ç§ç‰©å“åº“å­˜ä¸è¶³</text>
        </view>
        <view class="warning-item expiry" wx:if="{{expiryWarningCount > 0}}">
          <text class="warning-icon">â°</text>
          <text class="warning-text">{{expiryWarningCount}}ç§ç‰©å“å³å°†è¿‡æœŸ</text>
        </view>
      </view>
    </view>

    <!-- å‡ºå…¥åº“ç»Ÿè®¡ï¼šæŒ‰æ—¶é—´æ®µ -->
    <view class="section-title">å‡ºå…¥åº“ç»Ÿè®¡</view>
    <view class="io-stats-range">
      <view class="range-item">
        <text class="range-label">å¼€å§‹</text>
        <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
          <view class="range-value">{{startDate}}</view>
        </picker>
      </view>
      <view class="range-item">
        <text class="range-label">ç»“æŸ</text>
        <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
          <view class="range-value">{{endDate}}</view>
        </picker>
      </view>
    </view>
    <view class="io-stats-table" wx:if="{{ioStats.length > 0}}">
      <view class="io-stats-header">
        <text class="col-item">ç‰©å“</text>
        <text class="col-in">å…¥åº“</text>
        <text class="col-out">å‡ºåº“</text>
        <text class="col-net">å‡€å˜åŒ–</text>
      </view>
      <view class="io-stats-row" wx:for="{{ioStats}}" wx:key="itemType">
        <view class="col-item clickable" data-item-type="{{item.itemType}}" data-mode="both" bindtap="onIODetailTap">{{item.itemType}}</view>
        <view class="col-in clickable" data-item-type="{{item.itemType}}" data-mode="inbound" bindtap="onIODetailTap">{{item.inboundQty}}</view>
        <view class="col-out clickable" data-item-type="{{item.itemType}}" data-mode="outbound" bindtap="onIODetailTap">{{item.outboundQty}}</view>
        <text class="col-net {{item.netChange > 0 ? 'net-positive' : ''}} {{item.netChange < 0 ? 'net-negative' : ''}}">{{item.netChange}}</text>
      </view>
    </view>
    <view class="io-stats-empty" wx:if="{{ioStats.length === 0}}">
      <text class="io-stats-empty-text">è¯¥æ—¶é—´æ®µå†…æš‚æ— å‡ºå…¥åº“è®°å½•</text>
    </view>

    <!-- åº“å­˜æ˜ç»†ï¼šç‚¹å‡»å‡ºå…¥åº“ç»Ÿè®¡æ—¶æ˜¾ç¤ºæ˜ç»†ï¼Œå¦åˆ™æ˜¾ç¤ºåº“å­˜åˆ—è¡¨ -->
    <view class="section-title" id="detailSection">
      {{detailMode ? detailTitle : 'åº“å­˜æ˜ç»†'}}
      <text class="clear-detail" wx:if="{{detailMode}}" bindtap="onClearDetail">è¿”å›</text>
    </view>
    <view class="stats-list" wx:if="{{detailMode && detailList.length > 0}}">
      <view class="detail-row {{item.tag ? '' : (item.type === 'inbound' ? 'detail-inbound' : 'detail-outbound')}}" style="{{item.tag ? 'border-left: 6rpx solid ' + item.tag : ''}}" wx:for="{{detailList}}" wx:key="index">
        <view class="detail-left">
          <text class="detail-type">{{item.type === 'inbound' ? 'å…¥åº“' : 'å‡ºåº“'}}</text>
          <text class="detail-date">{{item.date}}</text>
          <text class="detail-user" wx:if="{{item.userName}}">æ“ä½œäººï¼š{{item.userName}}</text>
          <text class="detail-location" wx:if="{{item.location}}">è´§æ¶ï¼š{{item.location}}</text>
          <text class="detail-expiry" wx:if="{{item.expiryDate}}">åˆ°æœŸï¼š{{item.expiryDate}}</text>
        </view>
        <view class="detail-right">
          <text class="detail-qty">{{item.quantity}}</text>
        </view>
      </view>
    </view>
    <view class="empty-state" wx:elif="{{detailMode && detailList.length === 0}}">
      <text class="empty-hint">è¯¥æ—¶é—´æ®µå†…æš‚æ— è®°å½•</text>
    </view>
    <view class="stats-list" wx:elif="{{!detailMode && list.length > 0}}">
      <view class="stats-row {{item.expiryWarning ? 'row-expiry-alarm' : ''}}" wx:for="{{list}}" wx:key="id">
        <view class="row-left">
          <view class="row-name-wrap">
            <text class="row-name">{{item.itemType}}</text>
            <text class="row-location" wx:if="{{item.location}}">è´§æ¶ï¼š{{item.location}}</text>
            <view class="row-tag" wx:if="{{item.tag}}" style="background-color: {{item.tag}}"></view>
          </view>
          <view class="row-meta">
            <text class="row-meta-item">å…¥åº“ï¼š{{item.inboundDate || 'æ— '}}</text>
            <text class="row-meta-item">åˆ°æœŸï¼š{{item.expiryDate || 'æ— '}}</text>
          </view>
        </view>
        <view class="row-right">
          <text class="row-qty">{{item.quantity}}</text>
          <text class="row-alarm" wx:if="{{item.expiryWarning}}">å³å°†è¿‡æœŸ</text>
        </view>
      </view>
    </view>
    <view class="empty-state" wx:elif="{{!detailMode && list.length === 0}}">
      <text class="empty-icon">ğŸ“¦</text>
      <text class="empty-text">æš‚æ— åº“å­˜æ•°æ®</text>
      <text class="empty-hint">è¯·å…ˆè¿›è¡Œå…¥åº“æ“ä½œ</text>
    </view>
  </view>
</scroll-view>
